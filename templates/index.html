{% extends "base.html" %}

{% block content %}
<div class="status-panel">
    <div class="section-title">Robot Status</div>
    <div class="status-grid">
        <div class="status-item">
            <div><span id="connection-indicator" class="status-indicator"></span>Connection</div>
            <div id="connection-status">Checking...</div>
        </div>
        <div class="status-item">
            <div>Recording</div>
            <div id="recording-status">Idle</div>
        </div>
        <div class="status-item">
            <div>Playing</div>
            <div id="playing-status">Idle</div>
        </div>
        <div class="status-item">
            <div>Jiggling</div>
            <div id="jiggling-status">Idle</div>
        </div>
        <div class="status-item">
            <div>Recorded Moves</div>
            <div id="moves-count">0</div>
        </div>
        <div class="status-item">
            <div>Video Recording</div>
            <div id="video-recording-status">Idle</div>
        </div>
    </div>
    <div class="angles-display">
        <div class="angle-item">J1: <span id="angle-0">0¬∞</span></div>
        <div class="angle-item">J2: <span id="angle-1">0¬∞</span></div>
        <div class="angle-item">J3: <span id="angle-2">0¬∞</span></div>
        <div class="angle-item">J4: <span id="angle-3">0¬∞</span></div>
        <div class="angle-item">J5: <span id="angle-4">0¬∞</span></div>
        <div class="angle-item">J6: <span id="angle-5">0¬∞</span></div>
    </div>
</div>

<div class="main-content">
    <div class="control-grid">
        <div class="control-section">
            <div class="section-title">Basic Controls</div>
            <button onclick="runDemo()">Run Demo</button>
            <button onclick="moveHome()">Home Position</button>
            <button onclick="extend()">Extend</button>
        </div>
        
        <div class="control-section">
            <div class="section-title">Recording</div>
            <button id="start-recording-btn" onclick="startRecording()" class="btn-primary">Start Recording</button>
            <button id="capture-btn" onclick="capturePosition()" disabled>Capture Position</button>
            <button id="stop-recording-btn" onclick="stopRecording()" class="btn-danger" disabled>Stop Recording</button>
        </div>
        
        <div class="control-section">
            <div class="section-title">Choreography</div>
            <button id="play-btn" onclick="playChoreography()" class="btn-primary">Play</button>
            <button id="stop-play-btn" onclick="stopChoreography()" class="btn-danger" disabled>Stop</button>
            <button onclick="clearChoreography()" class="btn-warning">Clear All</button>
            <div class="choreography-list" id="choreography-list">
                <div>No moves recorded</div>
            </div>
        </div>
        
        <div class="control-section">
            <div class="section-title">Manual Joint Control</div>
            <div class="control-panel">
                <div class="speed-control">
                    <label class="speed-label">Speed: <span id="speed-value">50</span>%</label>
                    <input type="range" id="speed-slider" class="joint-slider" min="10" max="100" value="50" style="background: rgba(255,193,7,0.3);">
                </div>
                <button onclick="getCurrentPosition()" class="btn-primary">Sync Current</button>
                <button onclick="powerOff()" class="btn-warning">Power Off</button>
            </div>
            
            <div id="joint-controls">
                <!-- Joint sliders will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="control-section">
            <div class="section-title">Mouse Jiggler</div>
            <button id="start-jiggle-btn" onclick="startJiggling()" class="btn-primary">Start Jiggling</button>
            <button id="stop-jiggle-btn" onclick="stopJiggling()" class="btn-danger" disabled>Stop Jiggling</button>
            <p style="font-size: 12px; opacity: 0.8; margin-top: 10px;">
                First record some moves, then use this to jiggle the mouse continuously.
            </p>
        </div>
    </div>
    
    <div class="video-panel">
        <div class="section-title">üìπ Camera Feed</div>
        <div class="video-container">
            <img id="video-stream" class="video-stream" src="/video_feed" alt="Camera Feed">
            <div id="video-placeholder" class="video-placeholder">
                Camera Off<br>
                <small>Click Start Camera to begin streaming</small>
            </div>
        </div>
        <button id="start-camera-btn" onclick="startCamera()" class="btn-primary">Start Camera</button>
        <button id="stop-camera-btn" onclick="stopCamera()" class="btn-danger" disabled>Stop Camera</button>
        <button id="screenshot-btn" onclick="takeScreenshot()" class="btn-warning" disabled>üì∏ Screenshot</button>
        <br><br>
        <button id="start-video-btn" onclick="startVideoRecording()" class="btn-primary" disabled>üé• Start Recording</button>
        <button id="stop-video-btn" onclick="stopVideoRecording()" class="btn-danger" disabled>‚èπÔ∏è Stop Recording</button>
        <div id="video-status" style="margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.8);"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/robot-control.js') }}"></script>
<script src="{{ url_for('static', filename='js/camera.js') }}"></script>
<script src="{{ url_for('static', filename='js/positions.js') }}"></script>
{% endblock %}